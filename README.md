# ComfyUI Audio Cleanup 节点

这是一个 ComfyUI 自定义节点插件，用于对 TTS 生成的音频进行清理、降噪、归一化、混响控制等处理。

---

## 📦 功能特性

- ✅ 中文参数界面支持  
- 🎧 多种混响场景：小房间、大房间、大厅、山洞、浴室、走廊、山谷、教堂  
- 🔊 可调混响时间、强度、衰减速度  
- 🧹 支持降噪、滤波、动态压缩、音量调节、自动增益控制等功能  
- 🧪 高质量音频增强算法（Wiener 滤波 + STFT 降噪）  
- 💡 归一化输出确保音频兼容性  

---

## 🛠️ 库依赖说明

| 库名     | 用途             |
|----------|------------------|
| numpy    | 数值计算         |
| scipy    | 信号处理         |
| librosa  | 音频分析与处理   |
| soundfile| 音频读写         |
| torch    | ComfyUI 已内置   |
| pandas   | 一般也已安装     |

> ✅ 所以你无需运行 `pip install -r requirements.txt`，除非你发现某些环境缺少某个库。

---

## ⚙️ 节点参数说明

| 参数名           | 类型   | 默认值       | 范围                    | 说明                                                                 |
|------------------|--------|--------------|-------------------------|----------------------------------------------------------------------|
| 音频             | AUDIO  | —            | —                       | 输入的原始音频（ComfyUI格式）                                        |
| 降噪强度         | FLOAT  | `0.3`        | `0.1 ~ 1.0`             | 控制降噪程度，值越大降噪越强                                         |
| 去混响强度       | FLOAT  | `0.6`        | `0.0 ~ 1.0`             | 控制去混响程度，完全人声建议设为1.0                                  |
| 高通滤波频率     | FLOAT  | `80.0`       | `20.0 ~ 500.0 Hz`       | 过滤低频噪音，提高语音清晰度                                         |
| 低通滤波频率     | FLOAT  | `9000.0`     | `1000.0 ~ 16000.0 Hz`   | 过滤高频嘶嘶声                                                       |
| 归一化           | ENUM   | `true`       | `true / false`          | 将音频幅度标准化到 [-1, 1] 范围                                     |
| 压缩动态范围     | FLOAT  | `0.1`        | `0.0 ~ 1.0`             | 增强较安静部分的声音                                                 |
| 提升高频         | FLOAT  | `0.1`        | `0.0 ~ 1.0`             | 增强高频成分，使声音更明亮                                           |
| 音量增益_dB      | FLOAT  | `1.0`        | `-6.0 ~ 12.0 dB`        | 调整整体音量大小                                                     |
| 自动增益控制     | FLOAT  | `0.0`        | `0.0 ~ 1.0`             | 智能调整音量以达到最佳效果                                           |
| 添加回响         | ENUM   | `false`      | `false / 小房间 / 大房间 / 大厅 / 山洞 / 浴室 / 走廊 / 山谷 / 教堂` | 选择空间类型添加不同风格的混响效果 |
| 混响时间         | FLOAT  | `0.5`        | `0.1 ~ 2.0 秒`          | 混响持续时间，数值越大声音越“空旷”                                   |
| 混响强度         | FLOAT  | `0.3`        | `0.0 ~ 1.0`             | 混响信号在最终音频中所占比例                                         |
| 衰减速度         | FLOAT  | `0.8`        | `0.1 ~ 1.0`             | 控制混响回声的衰减速度，数值越高衰减越快                             |

---

## 📸 使用示例

### 示例 1：基本降噪与混响

```plaintext
输入音频 -> [降噪强度: 0.5, 去混响强度: 0.7] -> 输出音频

### 示例 2：完整音频增强

```plaintext
输入音频 -> [降噪强度: 0.8, 提升高频: 0.5, 音量增益_dB: 3.0, 添加回响: 大厅] -> 输出音频

📌 常见问题 FAQ
Q: 我在节点里看不到这个插件怎么办？
A: 请确认插件已正确放置在 custom_nodes 文件夹下，并重启 ComfyUI。

Q: 是否支持多通道音频？
A: 支持，但会自动提取第一个通道进行处理。

Q: 如何自定义混响类型？
A: 可修改 _generate_room_impulse 函数，添加新的混响延迟和权重组合。

Q: 是否可以导出处理后的音频？
A: 是的，你可以将输出连接到 ComfyUI 的音频保存节点，保存为 .wav 文件。
